%%
%% This is file `langselect.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% langselect.dtx  (with options: `pkg')
%% ----------------------------------------------------------------
%% langselect -- multiple language versions from a common source
%% E-mail: matthias.werner@informatik.tu-chemnitz.de
%% Released under the LaTeX Project Public License v1.3c or later
%% See http://www.latex-project.org/lppl.txt
%% ----------------------------------------------------------------
%% 
%%  (C) 2022-2025 Matthias Werner
%%
%%  Package langselect - generate documents in different languages
%%                       from common source.
%%

\NeedsTeXFormat{LaTeX2e}[2022/06/01]
\def\packagename{langselect}
\def\packageversion{2025/08/10 v0.9.0d}
\ProvidesPackage{\packagename}[\packageversion\space support for different
languages versions of a document]
\ExplSyntaxOn
\ExplSyntaxOn
\seq_const_from_clist:cn{olsIsoTags}{aa,ab,ae,af,ak,am,an,ar,as,av,ay,az,ba,be,bg,
  bh,bi,bm,bn,bo,br,bs,ca,ce,ch,co,cr,cs,cu,cv,cy,da,de,dv,dz,ee,el,en,eo,es,et,eu,
  fa,ff,fi,fj,fo,fr,fy,ga,gd,gl,gn,gu,gv,ha,he,hi,ho,hr,ht,hu,hy,hz,ia,id,ie,ig,ii,
  ik,io,is,it,iu,ja,jv,ka,kg,ki,kj,kk,kl,km,kn,ko,kr,ks,ku,kv,kw,ky,la,lb,lg,li,ln,
  lo,lt,lu,lv,mg,mh,mi,mk,ml,mn,mr,ms,mt,my,na,nb,nd,ne,ng,nl,nn,no,nr,nv,ny,oc,oj,
  om,or,os,pa,pi,pl,ps,pt,qu,rm,rn,ro,ru,rw,sa,sc,sd,se,sg,si,sk,sl,sm,sn,so,sq,sr,
  ss,st,su,sv,sw,ta,te,tg,th,ti,tk,tl,tn,to,tr,ts,tt,tw,ty,ug,uk,ur,uz,ve,vi,vo,wa,
  wo,xh,yi,yo,za,zh,zu}

\newcommand\IfTagIsValidF[2]{%
  \seq_if_in:ceF{olsIsoTags}{#1}{#2}
}
\RequirePackage{varsfromjobname}[2025/08/03]
\newcommand\olsChangeCatEleven[1]{
  \def\tmpa{#1}
  \edef\tmpb{
    \noexpand\scantokens{
      \noexpand\edef\noexpand\olsCatElven{\tmpa}
    }
  }
  \tmpb
}
\DeclareKeys{
  languages.clist_gset:N = \ols@langs,
  languages.usage=load,
  targetlang.code = {
    \cs_if_exist:NF\olsTargetLanguage{
          \str_if_eq:eeTF{\str_range:Nnn{#1}{1}{3}}{job}{% targetlang =job n
            \olsChangeCatEleven{\getfromjobname{\str_range:Nnn{#1}{-1}{-1}}}
            \edef\olsTargetLanguage{\olsCatElven}
            % % \typeout{**** Set~olsTargetLanguage='\olsTargetLanguage'}
          }{
            \str_if_eq:nnTF{#1}{meta}{
              % %\typeout{**~SEARCH~FOR~META}
              \IfDocumentMetadataTF{
                \edef\tmpa{\GetDocumentProperties{document/lang}}
                \edef\tmpb{\str_range:Nnn\tmpa{1}{2}}
                \olsChangeCatEleven{\tmpb}
                \typeout{*** Meta-lang: \GetDocumentProperties{document/lang},~**\tmpb}
                \edef\olsTargetLanguage{\olsCatElven}
              }{
                \PackageWarningNoLine{\packagename}{No~meta~data~provided, falling
                  back to English.}
               % %\edef\olsTargetLanguage{en}
              }
            }{
           \edef\olsTargetLanguage{#1}
         }
       }
     }{}
   },
  targetlang.usage=load,
  prefix.store=\osl@sprefix,
  prefix.initial:n=l,
  prefix.usage=load
}%
\ProcessKeyOptions\relax
\providecommand{\olsTargetLanguage}{en}
\typeout{*****~\string\olsTargetLanguage='\olsTargetLanguage'}
\IfTagIsValidF{\olsTargetLanguage}{
  \PackageError{\packagename}{Couldn't~resolve~target~language~'\olsTargetLanguage'}{See
    documentation.}
  \aftergroup\endinput
}
\int_compare:nNnT{\clist_count:N{\ols@langs}} < {2}{
  \PackageError{\packagename}{No~sufficient~number~of~selection\MessageBreak~languages~provided}{
    You~have~to~provide~a~list~of~two~or~three\MessageBreak
    languages~via~'language'~option.}
  \aftergroup\endinput
}
\int_compare:nNnT{\clist_count:N\ols@langs} > {3}{
      \PackageWarningNoLine{\packagename}{Too~many~selection~languages~provided.\MessageBreak
        I~will~ignore~the~superflous~languages}
}{}
\clist_map_inline:Nn\ols@langs {
  \typeout{***~CHECK~'#1'}
  \IfTagIsValidF{#1}{
    \typeout{***~Problem~'#1'}
    \PackageError{\packagename}{Couldn't~resolve~selection~language~'#1'}{
      Use~valid~ISO-639-1~code~in~option~'languages'.}
    \aftergroup\endinput
  }
  % %\typeout{*** '#1'~is~OKAY}
}
\clist_if_in:NVF\ols@langs{\olsTargetLanguage}{
  \PackageError{\packagename}{Target~language~'\olsTargetLanguage'~is~not\MessageBreak
    in~the~list~of~selection~languages}{
    Check~option~'language'~and~'targetlang'.}
}
\IfDocumentMetadataT{
  \str_if_eq:eeF{\olsTargetLanguage}{\str_range:nnn{\GetDocumentProperties{document/lang}}{1}{2}}{
    \PackageWarningNoLine{\packagename}{Target~language~'\olsTargetLanguage'~doesn't~comply~with
      \MessageBreak\string\DocumentMetadata.~Prepare~for~troubble.}
  }
}
\def\olsFrstLanguage{\clist_item:Nn \ols@langs{1}}
\def\olsScndLanguage{\clist_item:Nn \ols@langs{2}}
\typeout{***~First:~\olsFrstLanguage}
\typeout{***~Second:~\olsScndLanguage}
\NewDocumentCommand{\olsMakeBilangualMacro}{m m m}{
  \str_if_eq:eeT{\olsTargetLanguage}{#2}{
    \typeout{***~Define~for~first~language}
    \expandafter\long\expandafter\gdef\csname #1#2#3 \endcsname##1##2{##1}
  }
  \str_if_eq:eeT{\olsTargetLanguage}{#3}{
    \expandafter\long\expandafter\gdef\csname #1#2#3 \endcsname##1##2{##2}
    \typeout{***~Define~for~second~language}
  }
  \typeout{*** Make \string\ #1#2#3}
}
\olsMakeBilangualMacro{\osl@sprefix}{\olsFrstLanguage}{\olsScndLanguage}
\ExplSyntaxOff

%% This work is "maintained" (as per LPPL maintenance status) by
%% Matthias Werner.
%% 
%% This work consists of the file  langselect.dtx
%% and the derived files           langselect.pdf and
%%                                 langselect.sty.
%%
%% End of file `langselect.sty'.
